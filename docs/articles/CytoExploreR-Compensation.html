<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Compensation of Fluorescent Spillover • CytoExploreR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Compensation of Fluorescent Spillover">
<meta property="og:description" content="CytoExploreR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CytoExploreR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/CytoExploreR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CytoExploreR-Compensation.html">Compensation of Fluorescent Spillover</a>
    </li>
    <li>
      <a href="../articles/CytoExploreR-Manual-Gating.html">Manual Gating</a>
    </li>
    <li>
      <a href="../articles/CytoExploreR-Transformations.html">Data Transformations</a>
    </li>
    <li>
      <a href="../articles/CytoExploreR-Visualisations.html">Visualise Cytometry Data with cyto_plot()</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DillonHammill/CytoExploreR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="CytoExploreR-Compensation_files/header-attrs-2.5/header-attrs.js"></script><link href="CytoExploreR-Compensation_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="CytoExploreR-Compensation_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Compensation of Fluorescent Spillover</h1>
                        <h4 class="author">Dillon Hammill</h4>
            
            <h4 class="date">2021-04-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DillonHammill/CytoExploreR/blob/master/vignettes/CytoExploreR-Compensation.Rmd"><code>vignettes/CytoExploreR-Compensation.Rmd</code></a></small>
      <div class="hidden name"><code>CytoExploreR-Compensation.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<div style="line-height: 1.8em;">
In conventional flow cytometry, cells are labelled with fluorophore-conjugated antibodies and interrogated with a series of lasers which emit light of specific wavelengths. These fluorophores are excited by these lasers to emit photons of multiple energies and wavelengths, which are sorted by a series of optical filters to direct photons of the same wavelength to a specific detector. As a result, photons emitted from the excited fluorophores will be mostly collected by a single detctor (primary detector) but will also be collected by other detectors (secondary detectors). For example, photons emitted by a sample stained with only a FITC-conjugated antibody (FITC single colour control) will mostly be collected by the Alexa Fluor 488 primary detector, but there will also be collection by the PE secondary detector. When we compare the signal of our FITC single colour control relative to our unstained control (black) in these channels, it becomes clear that a proportion of the FITC signal is being collected by the PE detector. Clearly, this fluorescent spillover is not desirable, if we stained cells with both FITC and PE-conjugated antibodies it would be difficult to determine which events were truely labelled with our PE-conjugated antibodies.
</div>
<p><br></p>
<p><img src="Compensation/Compensation-1.png" width="100%" style="display: block; margin: auto;"></p>
<p><br></p>
<div style="line-height: 1.8em;">
Fortunately, it is relatively simple to compensate for fluorescent spillover into secondary detectors post data acquisition, using an unstained autofluorescence control and separate controls each labelled with a single fluorophore (single colour controls). Each single colour control is used to determine the proportion of the signal in the primary detector that is being collected by secondary detectors. This percentage spillover into secondary detectors is used to reduce the signal in the secondary detectors to ensure that each fluorophore is only detected by its primary detector. This can be a cumbersome process when performed manually, as this process must be repeated for each fluorophore and every detector. The end result of compensation is that any signal in PE detector is reduced such that the FITC signal is restricted to the Alexa Fluor 488 detector as shown below:
</div>
<p><br></p>
<p><img src="Compensation/Compensation-2.png" width="100%" style="display: block; margin: auto;"></p>
<p><br></p>
<div style="line-height: 1.8em;">
<p>In this vignette, we will explore the collection of compensation tools in <strong>CytoExploreR</strong> and demonstrate their appropriate use to accurately compensate for fluorescent spillover. The following functions will be explored in detail in this vignette:</p>
<ul>
<li>
<code>cyto_spillover_compute</code> to automatically compute spillover matrices using the method outlined by <a href="https://nyaspubs.onlinelibrary.wiley.com/doi/abs/10.1111/j.1749-6632.1993.tb38775.x?sid=nlm%3Apubmed">Bagwell &amp; Adams 1993</a>.</li>
<li>
<code>cyto_spillover_edit</code> to interactively edit spillover matrices in realtime to manually fine tune spillover values.</li>
<li>
<code>cyto_plot_compensation</code> to visualise compensated and uncompensated data in all fluorescent channels to identify any compensation issues.
</li>
</ul>
</div>

<p><br></p>
</div>
<div id="demonstration" class="section level1">
<h1 class="hasAnchor">
<a href="#demonstration" class="anchor"></a>Demonstration</h1>
<div id="prepare-compensation-controls" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-compensation-controls" class="anchor"></a>Prepare Compensation Controls</h2>
<div style="line-height: 1.8em;">
To demonstrate appropriate usage of these compensation tools, users will need to download the set of compensation controls shipped with <strong>CytoExploreRData</strong>. If you have not already done so, you can easily download these FCS files to a folder in your current working directory as outlined below:
</div>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load required packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">CytoExploreRData</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DillonHammill/CytoExploreR">CytoExploreR</a></span><span class="op">)</span>

<span class="co"># Compensation dataset</span>
<span class="va">Compensation</span>

<span class="co"># Save Compensation dataset FCS files to Compensation-Samples folder</span>
<span class="fu"><a href="../reference/cyto_save.html">cyto_save</a></span><span class="op">(</span><span class="va">Compensation</span>, save_as <span class="op">=</span> <span class="st">"Compensation-Samples"</span><span class="op">)</span></code></pre></div>
<div style="line-height: 1.8em;">
Now that we have the FCS files saved locally, let’s load in the compensation controls and setup a new gatingTemplate using <code>cyto_setup</code>. Users should enter in the marker assignments in the table editor, this ensures that the antibody panel used for the experiment is saved to a csv file for future reference. This Experiment-Markers.csv file will be automatically applied when loading in the fully stained samples. Later on in this vignette, <strong>CytoExploreR</strong> will ask us to assign a fluorescent channel to each single colour control to determine the degree of spillover into secondary detectors. Users may wish to enter these channels manually in the experiment details table editor by adding a “channel” column and typing in a channel name for each compensation control (entries for unstained controls should be left empty). Typing out names of fluorescent channels manually can lead to typing errors, so for the purpose of this vignette I will show you how you can select these channels from a drop down menu instead.
</div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compensation GatingSet</span>
<span class="va">gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cyto_setup.html">cyto_setup</a></span><span class="op">(</span><span class="st">"Compensation-Samples"</span>,
                 gatingTemplate <span class="op">=</span> <span class="st">"Compensation-gatingTemplate.csv"</span><span class="op">)</span></code></pre></div>
<p><img src="Compensation/Compensation-3.png" width="40%" style="display: block; margin: auto;"></p>
<div style="line-height: 1.8em;">
It is recommended that the compensation controls be appropriately transformed before proceeding. <strong>CytoExploreR</strong> will detect if the data has not been transformed and automatically apply the biexponential transformation to each of the fluorescent channels. The default parameters for these transformations may not be perfect for all channels, so it recommended that these transformations be optimised manually by the user. For more information on data transformation types and implementation, refer to the Transformations vignette where this is explained in detail. For now, let’s use the more robust logicle transformation and apply it to all the fluorescent channels using <code>cyto_transform</code>. All fluorescent channels be transformed by default unless specific channels or markers are passed through the channels argument.
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Apply logicle transformation to fluorescent channels</span>
<span class="va">gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cyto_transform.html">cyto_transform</a></span><span class="op">(</span><span class="va">gs</span>,
                     type <span class="op">=</span> <span class="st">"logicle"</span><span class="op">)</span></code></pre></div>
<p><img src="Compensation/Compensation-4.png" width="75%" style="display: block; margin: auto;"></p>
<div style="line-height: 1.8em;">
Next, we should gate the compensation controls to remove debris and doublets to yield the most accurate spillover values. Let’s manually gate down to single cells using <code>cyto_gate_draw</code>. Back gating can prove extremely useful in cleaning up the data. For example, we could gate the dead cells using our Hoechst control and overly this population on our initial FSC/SSC gate to adjust the gate to avoid dead cells. For brevity this approach will not be demonstrated here, but I will document this process in an issue for those who are interested.
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/cyto_gate_draw.html">cyto_gate_draw</a></span><span class="op">(</span><span class="va">gs</span>,
               parent <span class="op">=</span> <span class="st">"root"</span>,
               alias <span class="op">=</span> <span class="st">"Cells"</span>,
               channels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FSC-A"</span>, <span class="st">"SSC-A"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Compensation/Compensation-5.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/cyto_gate_draw.html">cyto_gate_draw</a></span><span class="op">(</span><span class="va">gs</span>,
               parent <span class="op">=</span> <span class="st">"Cells"</span>,
               alias <span class="op">=</span> <span class="st">"Single Cells"</span>,
               channels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FSC-A"</span>, <span class="st">"SSC-A"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Compensation/Compensation-6.png" width="60%" style="display: block; margin: auto;"></p>
</div>
<div id="automated-computation-of-spillover-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#automated-computation-of-spillover-matrix" class="anchor"></a>Automated Computation of Spillover Matrix</h2>
<div style="line-height: 1.8em;">
Now that our compensation controls have been transformed and pre-gated, we can move on to automatically computing the spillover matrix using <code>cyto_spillover_compute</code>. All we need to do is supply the prepared compensation controls, indicate which population we want to use for the calculation and supply a name of csv file to which the computed matrix will be saved. The computed spillover matrix will also be returned as an R object, so let’s assign this to <code>spill</code> so that we can use it later on.
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Automated compensation</span>
<span class="va">spill</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cyto_spillover_compute.html">cyto_spillover_compute</a></span><span class="op">(</span><span class="va">gs</span>,
                                parent <span class="op">=</span> <span class="st">"Single Cells"</span>,
                                spillover <span class="op">=</span> <span class="st">"Spillover-Matrix.csv"</span><span class="op">)</span></code></pre></div>
<div style="line-height: 1.8em;">
<p><code>cyto_spillover_compute</code> will guide the user through the following steps to automatically compute the spillover matrix:</p>
<ul>
<li>
<strong>Selection of a fluorescent channel for each compensation control from a drop menu.</strong> Channel selection can also be bypassed by manually adding a “channel” column using <code>cyto_details_edit</code> as outlined above, or by supplying a <code>channel_match</code> csv file containing a “name” and “channel” column. Channel match files can be manually created using <code>cyto_channel_match</code> if desired.</li>
</ul>
<p><img src="Compensation/Compensation-7.png" width="75%" style="display: block; margin: auto;"></p>
<ul>
<li>
<strong>Gating of the positive (and negative) signal for each compensation control in the assigned channel.</strong> In order to properly compute the spillover values, <strong>CytoExploreR</strong> requires an appropriate unstained reference population. This reference population can take the form of a universal unstained control (as demonstrated below) or unstained events within each compensation control. When using a universal unstained control, the unstained control will be overlaid onto the plot and users be asked to gate the positive signal for each of the compensation controls. Otherwise, users will be asked to gate the negative and then the positive signal for each compensation control. The accuracy of the spillover calculation is heavily dependant on where these gates are positioned, with practice it will become clear that it is best to retain the final peak and tail in the positive gates.</li>
</ul>
<p><img src="Compensation/Compensation-8.png" width="60%" style="display: block; margin: auto;"></p>
<ul><li>
<strong>Computation and saving of the spillover matrix.</strong> It is that simple! <code>cyto_spillover_compute</code> will take of the computations internally, return the computed spillover matrix and save the matrix to a named csv file for downstream use.
</li></ul>
</div>

<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Computed spillover matrix</span>
<span class="va">spill</span></code></pre></div>
<p><img src="Compensation/Compensation-9.png" width="100%" style="display: block; margin: auto;"></p>
<div style="line-height: 1.8em;">
To aid in the calculation of accurate spillover values, <code>cyto_spillover_compute</code> also supports the use of different populations for each compensation control to ensure proper autofluorescence correction. For example, we compensating for a marker such as CD11b it would be desirable to isolate just the myeloid cells and use this population for the spillover computation. This can be important, as myeloid cells may have a distinct autofluorescence profile compared to other cell types in the sample, which will influence the computed spillover value. For this reason, try to make sure that the composition of the populations in negative and positive populations are the same. To use a different parent population for each compensation control, users can manually supply a vector of population names to the <code>parent</code> argument, or manually enter this information into a <code>parent</code> column of <code>cyto_details</code> using <code>cyto_details_edit</code>.
</div>
</div>
<div id="interactively-edit-spillover-matrices" class="section level2">
<h2 class="hasAnchor">
<a href="#interactively-edit-spillover-matrices" class="anchor"></a>Interactively Edit Spillover Matrices</h2>
<div style="line-height: 1.8em;">
As described above, automatically computing the spillover matrix is heavily dependant on how the populations are gated prior to computing the spillover matrix. As a result, <code>cyto_spillover_compute</code> may not always get the degree of compensation exactly correct and manual adjustment will be required. Luckily, <strong>CytoExploreR</strong> has a fantastic interactive spillover matrix editor that allows editing of spillover values in realtime. To start up the spillover matrix editor we can simply change <code>compute</code> from the <code>cyto_spillover_compute</code> call to <code>edit</code>.
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Open CytoExploreR spillover matrix editor</span>
<span class="va">spill</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cyto_spillover_edit.html">cyto_spillover_edit</a></span><span class="op">(</span><span class="va">gs</span>,
                             parent <span class="op">=</span> <span class="st">"Single Cells"</span>,
                             spillover <span class="op">=</span> <span class="st">"Spillover-Matrix.csv"</span><span class="op">)</span></code></pre></div>
<div style="line-height: 1.8em;">
In the <strong>Editor</strong> tab, users will encounter series of dropdown menus to select controls and channels, an interactive spillover matrix and some plots to track changes to the data in realtime as the spillover values are edited. In this case, we want to edit the computed spillover matrix saved to “Spillover-Matrix.csv” but it is also possible to edit the spillover matrix attached to each control by removing the <code>spillover</code> argument. In the 2D scatter plot, we can see a horizontal red line through the median of the unstained control as well as a purple line which tracks the median through the stained control. By definition, the correct spillover value is reached once these two lines cross in the positive population and the medFI of stained population matches that of the unstained population in secondary detectors. As you can see below it looks like we need to remove some more of the FITC signal from the PE detector.
</div>
<p><img src="Compensation/Compensation-10.png" width="100%" style="display: block; margin: auto;"></p>
<div style="line-height: 1.8em;">
Changing the spillover values is as easy as selecting and replacing the value that you would like to edit. The plots below the matrix will automatically update whenever changes are made to the matrix. The spillover values can then be fine tuned such that the medFI of the stained and unstained populations are the same. Compare the figure below to previous one to see how changing the spillover value of Alexa Fluor 488 into PE to 18.16 alters the plots and medFIs. Changing spillover values manually will affect other secondary detectors, so this must be repeated for all secondary detectors by changing the selected channel in the y axis dropdown menu. Remember, <code>cyto_spillover_edit</code> accepts all <code>cyto_plot</code> arguments so it is possible to make the points bigger or add contour lines to aid in setting accurate spillover values.
</div>
<p><img src="Compensation/Compensation-11.png" width="100%" style="display: block; margin: auto;"></p>
<div style="line-height: 1.8em;">
Identifying compensation issues in large dataset can be an extremely tedious process, this where the the <strong>Plots</strong> tab can help. If you switch over to the plots tab, users can select a compensation control and display the signal in the primary detector against all secondary detectors. To highlight any compensation issues, the compensated and unstained data are overlaid onto the uncompensated data. Very quickly we can identify any lingering issues and return to the editor tab to make appropriate adjustments. Finally, the changes made to the spillover matrix can be saved by selecting the <code>save</code> button on the <code>editor</code> tab. The updated spillover matrix will be returned as an R object and updated in the csv file.
</div>
<p><img src="Compensation/Compensation-12.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div id="visualise-compensation" class="section level2">
<h2 class="hasAnchor">
<a href="#visualise-compensation" class="anchor"></a>Visualise Compensation</h2>
<div style="line-height: 1.8em;">
It is also possible to generate the plots in the plots tab externally of the spillover matrix editor using <code>cyto_plot_compensation</code>. This is a special plotting function that can perform inline compensation, so that you don’t have to worry about inversing transformations, applyig the compensation and re-transforming the data to check whether the compensation is correct. Simply set <code>compensate</code> to TRUE and <code>cyto_plot_compensation</code> will plot the compensated data for each compensation control in all fluorescent channels. As before, if no spillover matrix is supplied to the <code>spillover</code> argument, the matrix attached to each of the compensation controls will be applied. Of course this function inherits from <code>cyto_plot_theme</code> and accepts all <code>cyto_plot</code> arguments so that you can customise it to your heart’s content.
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/cyto_plot_compensation.html">cyto_plot_compensation</a></span><span class="op">(</span><span class="va">gs</span>,
                       parent <span class="op">=</span> <span class="st">"Single Cells"</span><span class="op">)</span></code></pre></div>
<p><img src="Compensation/Compensation-13.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/cyto_plot_compensation.html">cyto_plot_compensation</a></span><span class="op">(</span><span class="va">gs</span>,
                       parent <span class="op">=</span> <span class="st">"Single Cells"</span>,
                       spillover <span class="op">=</span> <span class="st">"Spillover-Matrix.csv"</span>,
                       compensate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="Compensation/Compensation-14.png" width="100%" style="display: block; margin: auto;"></p>
<div style="line-height: 1.8em;">
As you can see from the above plots, <strong>CytoExploreR</strong> does a pretty great job at appropriately compensating the data. Now that we have our fine tuned spillover matrix, we are done with our compensation controls and all we need to do is apply the saved spillover matrix to our samples.
</div>
</div>
<div id="apply-compensation-to-samples" class="section level2">
<h2 class="hasAnchor">
<a href="#apply-compensation-to-samples" class="anchor"></a>Apply Compensation to Samples</h2>
<div style="line-height: 1.8em;">
For completeness, I will demonstrate how we can apply the saved spillover matrix to our gated and transformed compensation controls. It is important to remember that compenstion of fluorescent spillover must occur prior to data transformations. Since our compensation controls have been transformed, we will need to load in the samples again, compensate the samples with the saved spillover matrix, re-apply the data transformations and finally re-apply any gates. These are the same steps that will be used to load, compensate, transform and gate our samples during downstream analyses.
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compensation GatingSet</span>
<span class="va">gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cyto_setup.html">cyto_setup</a></span><span class="op">(</span><span class="st">"Compensation-Samples"</span>,
                 gatingTemplate <span class="op">=</span> <span class="st">"Compensation-gatingTemplate.csv"</span><span class="op">)</span>

<span class="co"># Apply compensation</span>
<span class="va">gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cyto_compensate.html">cyto_compensate</a></span><span class="op">(</span><span class="va">gs</span>,
                      spillover <span class="op">=</span> <span class="st">"Spillover-Matrix.csv"</span><span class="op">)</span>

<span class="co"># Data transformations</span>
<span class="va">gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cyto_transform.html">cyto_transform</a></span><span class="op">(</span><span class="va">gs</span>,
                     type <span class="op">=</span> <span class="st">"logicle"</span><span class="op">)</span>

<span class="co"># Apply gates</span>
<span class="fu"><a href="../reference/cyto_gatingTemplate_apply.html">cyto_gatingTemplate_apply</a></span><span class="op">(</span><span class="va">gs</span>,
                          gatingTemplate <span class="op">=</span> <span class="st">"Compensation-gatingTemplate.csv"</span><span class="op">)</span></code></pre></div>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<div style="line-height: 1.8em;">
<p><strong>CytoExploreR</strong> has a powerful suite of compensation tools to ensure that your flow cytometry data is appropriately compensated prior to analysis. Here are the key points that were outlined in this vignette:</p>
<ul>
<li><p>Compensation of fluorescent spillover must be applied to samples prior to data transformations. If your data looks strange or unchanged after applying compensation it is likely that you are trying to compensate transformed data.</p></li>
<li><p>Automated compensation will always perform well if your compensation controls are appropriately gated. It is also important to try and ensure that the composition (cell types) of your negative and positive populations are the same to minimise autofluorescence issues.</p></li>
<li><p>The best way to use the spillover matrix editor is to first look at the plots tab to identify issues and then switch over to the editor tab to address these issues. It is not recommended that spillover matrices be edited from scratch as changes can have unexpected consequences. The spillover matrix editor is designed to be a tool to fine tune the spillover values automatically computed by <code>cyto_spillover_compute</code>. This approach will save you a lot of time!</p></li>
</ul>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Dillon Hammill.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
